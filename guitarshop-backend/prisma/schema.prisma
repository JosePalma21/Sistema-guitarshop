generator client {
  provider = "prisma-client"
  output   = "../generated/prisma"
  binaryTargets = ["native", "windows", "debian-openssl-3.0.x"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model cliente {
  id_cliente        Int             @id @default(autoincrement())
  nombres           String          @db.VarChar(60)
  apellidos         String          @db.VarChar(60)
  cedula            String          @unique @db.VarChar(10)
  correo            String?         @db.VarChar(120)
  telefono          String?         @db.VarChar(20)
  direccion         String?         @db.VarChar(150)
  fecha_registro    DateTime        @default(now()) @db.Timestamp(6)
  id_estado         Int             @default(1)
  id_usuario_modifi Int?
  estado_registro   estado_registro @relation(fields: [id_estado], references: [id_estado], onDelete: NoAction, onUpdate: NoAction, map: "fk_cliente_estado")
  usuario           usuario?        @relation(fields: [id_usuario_modifi], references: [id_usuario], onUpdate: NoAction, map: "fk_cliente_usuario_modifi")
  factura           factura[]
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model compra {
  id_compra                                 Int               @id @default(autoincrement())
  fecha_compra                              DateTime          @default(now()) @db.Timestamp(6)
  id_proveedor                              Int
  id_usuario                                Int
  observacion                               String?           @db.VarChar(255)
  subtotal                                  Decimal           @default(0) @db.Decimal(12, 2)
  impuesto                                  Decimal           @default(0) @db.Decimal(12, 2)
  total                                     Decimal           @default(0) @db.Decimal(12, 2)
  id_estado                                 Int               @default(1)
  id_usuario_modifi                         Int?
  estado_registro                           estado_registro   @relation(fields: [id_estado], references: [id_estado], onDelete: NoAction, onUpdate: NoAction, map: "fk_compra_estado")
  proveedor                                 proveedor         @relation(fields: [id_proveedor], references: [id_proveedor], onDelete: NoAction, onUpdate: NoAction, map: "fk_compra_proveedor")
  usuario                                   usuario           @relation(fields: [id_usuario], references: [id_usuario], onDelete: NoAction, onUpdate: NoAction, map: "fk_compra_usuario")
  usuario_compra_id_usuario_modifiTousuario usuario?          @relation("compra_id_usuario_modifiTousuario", fields: [id_usuario_modifi], references: [id_usuario], onUpdate: NoAction, map: "fk_compra_usuario_modifi")
  producto_compra                           producto_compra[]
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model credito {
  id_credito        Int             @id @default(autoincrement())
  id_factura        Int
  monto_total       Decimal         @db.Decimal(12, 2)
  saldo_pendiente   Decimal         @db.Decimal(12, 2)
  estado_credito    String          @default("ACTIVO") @db.VarChar(20)
  fecha_inicio      DateTime        @db.Date
  fecha_fin         DateTime?       @db.Date
  id_estado         Int             @default(1)
  id_usuario_modifi Int?
  estado_registro   estado_registro @relation(fields: [id_estado], references: [id_estado], onDelete: NoAction, onUpdate: NoAction, map: "fk_credito_estado")
  factura           factura         @relation(fields: [id_factura], references: [id_factura], onDelete: NoAction, onUpdate: NoAction, map: "fk_credito_factura")
  usuario           usuario?        @relation(fields: [id_usuario_modifi], references: [id_usuario], onUpdate: NoAction, map: "fk_credito_usuario_modifi")
  cuota             cuota[]
}

model cuota {
  id_cuota          Int       @id @default(autoincrement())
  id_credito        Int
  numero_cuota      Int
  fecha_vencimiento DateTime  @db.Date
  monto_cuota       Decimal   @db.Decimal(12, 2)
  monto_pagado      Decimal   @default(0) @db.Decimal(12, 2)
  estado_cuota      String    @default("PENDIENTE") @db.VarChar(20)
  fecha_pago        DateTime? @db.Date
  id_usuario_modifi Int?
  credito           credito   @relation(fields: [id_credito], references: [id_credito], onDelete: Cascade, onUpdate: NoAction, map: "fk_cuota_credito")
  usuario           usuario?  @relation(fields: [id_usuario_modifi], references: [id_usuario], onUpdate: NoAction, map: "fk_cuota_usuario_modifi")

  @@unique([id_credito, numero_cuota], map: "ux_cuota_unica")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model detalle_factura {
  id_detalle_factura Int             @id @default(autoincrement())
  id_factura         Int
  id_producto        Int
  cantidad           Int
  precio_unitario    Decimal         @db.Decimal(12, 2)
  descuento          Decimal         @default(0) @db.Decimal(12, 2)
  subtotal           Decimal         @db.Decimal(12, 2)
  id_estado          Int             @default(1)
  id_usuario_modifi  Int?
  factura            factura         @relation(fields: [id_factura], references: [id_factura], onDelete: Cascade, onUpdate: NoAction, map: "fk_detalle_factura")
  estado_registro    estado_registro @relation(fields: [id_estado], references: [id_estado], onDelete: NoAction, onUpdate: NoAction, map: "fk_detalle_factura_estado")
  usuario            usuario?        @relation(fields: [id_usuario_modifi], references: [id_usuario], onUpdate: NoAction, map: "fk_detalle_factura_usuario_modifi")
  producto           producto        @relation(fields: [id_producto], references: [id_producto], onDelete: NoAction, onUpdate: NoAction, map: "fk_detalle_producto")

  @@unique([id_factura, id_producto], map: "ux_detalle_factura_unico")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model factura {
  id_factura                                 Int               @id @default(autoincrement())
  numero_factura                             String            @unique @db.VarChar(30)
  fecha_factura                              DateTime          @default(now()) @db.Timestamp(6)
  id_cliente                                 Int
  id_usuario                                 Int
  observacion                                String?           @db.VarChar(255)
  forma_pago                                 String            @default("CONTADO") @db.VarChar(30)
  subtotal                                   Decimal           @default(0) @db.Decimal(12, 2)
  impuesto                                   Decimal           @default(0) @db.Decimal(12, 2)
  total                                      Decimal           @default(0) @db.Decimal(12, 2)
  id_estado                                  Int               @default(1)
  id_usuario_modifi                          Int?
  credito                                    credito[]
  detalle_factura                            detalle_factura[]
  cliente                                    cliente           @relation(fields: [id_cliente], references: [id_cliente], onDelete: NoAction, onUpdate: NoAction, map: "fk_factura_cliente")
  estado_registro                            estado_registro   @relation(fields: [id_estado], references: [id_estado], onDelete: NoAction, onUpdate: NoAction, map: "fk_factura_estado")
  usuario                                    usuario           @relation(fields: [id_usuario], references: [id_usuario], onDelete: NoAction, onUpdate: NoAction, map: "fk_factura_usuario")
  usuario_factura_id_usuario_modifiTousuario usuario?          @relation("factura_id_usuario_modifiTousuario", fields: [id_usuario_modifi], references: [id_usuario], onUpdate: NoAction, map: "fk_factura_usuario_modifi")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model kardex {
  id_kardex         Int             @id @default(autoincrement())
  id_producto       Int
  fecha_movimiento  DateTime        @default(now()) @db.Timestamp(6)
  tipo_movimiento   String          @db.VarChar(20)
  origen            String          @db.VarChar(20)
  id_referencia     Int?
  cantidad          Int
  costo_unitario    Decimal         @db.Decimal(12, 2)
  comentario        String?         @db.VarChar(255)
  id_estado         Int             @default(1)
  id_usuario_modifi Int?
  estado_registro   estado_registro @relation(fields: [id_estado], references: [id_estado], onDelete: NoAction, onUpdate: NoAction, map: "fk_kardex_estado")
  usuario           usuario?        @relation(fields: [id_usuario_modifi], references: [id_usuario], onUpdate: NoAction, map: "fk_kardex_usuario_modifi")
  producto          producto        @relation(fields: [id_producto], references: [id_producto], onDelete: NoAction, onUpdate: NoAction, map: "fk_kx_producto")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model producto {
  id_producto       Int               @id @default(autoincrement())
  codigo_producto   String            @unique @db.VarChar(30)
  nombre_producto   String            @db.VarChar(100)
  descripcion       String?           @db.VarChar(255)
  id_proveedor      Int?
  precio_compra     Decimal           @default(0) @db.Decimal(12, 2)
  precio_venta      Decimal           @default(0) @db.Decimal(12, 2)
  cantidad_stock    Int               @default(0)
  stock_minimo      Int               @default(0)
  fecha_creacion    DateTime          @default(now()) @db.Timestamp(6)
  id_estado         Int               @default(1)
  id_usuario_modifi Int?
  detalle_factura   detalle_factura[]
  kardex            kardex[]
  estado_registro   estado_registro   @relation(fields: [id_estado], references: [id_estado], onDelete: NoAction, onUpdate: NoAction, map: "fk_producto_estado")
  proveedor         proveedor?        @relation(fields: [id_proveedor], references: [id_proveedor], onDelete: NoAction, onUpdate: NoAction, map: "fk_producto_proveedor")
  usuario           usuario?          @relation(fields: [id_usuario_modifi], references: [id_usuario], onUpdate: NoAction, map: "fk_producto_usuario_modifi")
  producto_compra   producto_compra[]
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model producto_compra {
  id_producto_compra Int             @id @default(autoincrement())
  id_compra          Int
  id_producto        Int
  cantidad_compra    Int
  costo_unitario     Decimal         @db.Decimal(12, 2)
  subtotal           Decimal         @db.Decimal(12, 2)
  id_estado          Int             @default(1)
  id_usuario_modifi  Int?
  compra             compra          @relation(fields: [id_compra], references: [id_compra], onDelete: Cascade, onUpdate: NoAction, map: "fk_pc_compra")
  producto           producto        @relation(fields: [id_producto], references: [id_producto], onDelete: NoAction, onUpdate: NoAction, map: "fk_pc_producto")
  estado_registro    estado_registro @relation(fields: [id_estado], references: [id_estado], onDelete: NoAction, onUpdate: NoAction, map: "fk_producto_compra_estado")
  usuario            usuario?        @relation(fields: [id_usuario_modifi], references: [id_usuario], onUpdate: NoAction, map: "fk_producto_compra_usuario_modifi")

  @@unique([id_compra, id_producto], map: "ux_producto_compra_unico")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model proveedor {
  id_proveedor      Int             @id @default(autoincrement())
  nombre_proveedor  String          @db.VarChar(100)
  ruc_cedula        String          @unique @db.VarChar(13)
  correo            String?         @db.VarChar(120)
  telefono          String?         @db.VarChar(20)
  direccion         String?         @db.VarChar(150)
  fecha_registro    DateTime        @default(now()) @db.Timestamp(6)
  id_estado         Int             @default(1)
  id_usuario_modifi Int?
  compra            compra[]
  producto          producto[]
  estado_registro   estado_registro @relation(fields: [id_estado], references: [id_estado], onDelete: NoAction, onUpdate: NoAction, map: "fk_proveedor_estado")
  usuario           usuario?        @relation(fields: [id_usuario_modifi], references: [id_usuario], onUpdate: NoAction, map: "fk_proveedor_usuario_modifi")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model usuario {
  id_usuario                                 Int               @id @default(autoincrement())
  nombre_completo                            String            @db.VarChar(100)
  correo                                     String            @unique @db.VarChar(120)
  telefono                                   String?           @db.VarChar(20)
  direccion                                  String?           @db.VarChar(150)
  cedula                                     String?           @unique @db.VarChar(10)
  rol                                        String            @default("VENDEDOR") @db.VarChar(30)
  password_hash                              String            @db.VarChar(255)
  fecha_creacion                             DateTime          @default(now()) @db.Timestamp(6)
  id_estado                                  Int               @default(1)
  id_usuario_modifi                          Int?
  cliente                                    cliente[]
  compra                                     compra[]
  compra_compra_id_usuario_modifiTousuario   compra[]          @relation("compra_id_usuario_modifiTousuario")
  credito                                    credito[]
  cuota                                      cuota[]
  detalle_factura                            detalle_factura[]
  factura                                    factura[]
  factura_factura_id_usuario_modifiTousuario factura[]         @relation("factura_id_usuario_modifiTousuario")
  kardex                                     kardex[]
  producto                                   producto[]
  producto_compra                            producto_compra[]
  proveedor                                  proveedor[]
  estado_registro                            estado_registro   @relation(fields: [id_estado], references: [id_estado], onDelete: NoAction, onUpdate: NoAction, map: "fk_usuario_estado")
  usuario                                    usuario?          @relation("usuarioTousuario", fields: [id_usuario_modifi], references: [id_usuario], onUpdate: NoAction, map: "fk_usuario_usuario_modifi")
  other_usuario                              usuario[]         @relation("usuarioTousuario")
}

model estado_registro {
  id_estado       Int               @id @default(autoincrement())
  nombre_estado   String            @unique @db.VarChar(30)
  descripcion     String?           @db.VarChar(100)
  cliente         cliente[]
  compra          compra[]
  credito         credito[]
  detalle_factura detalle_factura[]
  factura         factura[]
  kardex          kardex[]
  producto        producto[]
  producto_compra producto_compra[]
  proveedor       proveedor[]
  usuario         usuario[]
}
